{% comment %}
  MOBY Custom Floating Header
  - Centered, not full-width
  - Shrinks on scroll
  - Semi-transparent background
{% endcomment %}

{% liquid
  assign transparent = false
  if section.settings.enable_transparent and template.name == 'index'
    assign transparent = true
  endif
%}

<moby-header
  id="moby-header"
  class="moby-header{% if transparent %} moby-header--transparent{% endif %}"
  data-transparent="{{ transparent }}"
>
  <div class="moby-header__container">
    <nav class="moby-header__nav">
      <!-- Logo -->
      <a href="{{ routes.root_url }}" class="moby-header__logo">
        <span class="moby-header__logo-text">MOBY</span>
      </a>

      <!-- Desktop Navigation -->
      <ul class="moby-header__menu">
        {% for link in section.settings.menu.links %}
          <li class="moby-header__menu-item">
            <a href="{{ link.url }}" class="moby-header__menu-link">
              {{ link.title }}
            </a>
          </li>
        {% endfor %}
      </ul>

      <!-- Right Actions -->
      <div class="moby-header__actions">
        <!-- Account Icon -->
        <a href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}" class="moby-header__icon-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="8" r="4"/>
            <path d="M4 21c0-4.5 3.5-7 8-7s8 2.5 8 7"/>
          </svg>
        </a>

        <!-- Currency Selector -->
        <button type="button" class="moby-header__currency-btn">
          <span class="moby-header__currency-symbol">â‚¬</span>
          <span class="moby-header__currency-code">EUR</span>
          <svg class="moby-header__caret" width="10" height="6" viewBox="0 0 10 6" fill="none">
            <path d="M1 1L5 5L9 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <!-- Cart Button -->
        <a href="{{ routes.cart_url }}" class="moby-header__cart">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <rect x="4" y="7" width="16" height="14" rx="2" stroke="currentColor" stroke-width="1.5"/>
            <path d="M8 7V6a4 4 0 118 0v1" stroke="currentColor" stroke-width="1.5"/>
            <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="moby-header__cart-text">CART</span>
        </a>
      </div>

      <!-- Mobile Menu Toggle -->
      <button type="button" class="moby-header__mobile-toggle" aria-label="Menu" aria-expanded="false">
        <svg class="moby-header__hamburger" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <line x1="4" y1="7" x2="20" y2="7"/>
          <line x1="4" y1="12" x2="20" y2="12"/>
          <line x1="4" y1="17" x2="20" y2="17"/>
        </svg>
        <svg class="moby-header__close" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="display: none;">
          <line x1="6" y1="6" x2="18" y2="18"/>
          <line x1="6" y1="18" x2="18" y2="6"/>
        </svg>
      </button>
    </nav>
  </div>

  <!-- Mobile Menu Drawer -->
  <div class="moby-header__mobile-menu" hidden>
    <ul class="moby-header__mobile-links">
      {% for link in section.settings.menu.links %}
        <li>
          <a href="{{ link.url }}" class="moby-header__mobile-link">
            {{ link.title }}
          </a>
        </li>
      {% endfor %}
    </ul>
  </div>
</moby-header>

<style>
  :root {
    --moby-lime: #F9FDB5;
    --moby-olive: #4F4A32;
    --moby-sage: #C9C8B6;
    --moby-dark: #1C1A10;
    --moby-header-height: 56px;
  }

  .moby-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    padding: 20px 24px;
    transition: padding 0.3s ease;
  }

  @media (min-width: 768px) {
    .moby-header {
      padding: 20px 40px;
    }
  }

  .moby-header--scrolled {
    padding: 12px 24px;
  }

  @media (min-width: 768px) {
    .moby-header--scrolled {
      padding: 12px 40px;
    }
  }

  .moby-header__container {
    max-width: 1200px;
    margin: 0 auto;
  }

  .moby-header__nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(79, 74, 50, 0.92);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-radius: 100px;
    padding: 8px 8px 8px 20px;
    gap: 8px;
    transition: all 0.3s ease;
  }

  .moby-header--scrolled .moby-header__nav {
    padding: 6px 6px 6px 18px;
  }

  /* Logo */
  .moby-header__logo {
    display: flex;
    align-items: center;
    text-decoration: none;
    flex-shrink: 0;
  }

  .moby-header__logo-text {
    font-family: var(--font-heading--family, system-ui, sans-serif);
    font-size: 20px;
    font-weight: 600;
    color: var(--moby-lime);
    letter-spacing: 0.15em;
  }

  .moby-header--scrolled .moby-header__logo-text {
    font-size: 18px;
  }

  /* Desktop Menu */
  .moby-header__menu {
    display: none;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 0;
  }

  @media (min-width: 1024px) {
    .moby-header__menu {
      display: flex;
    }
  }

  .moby-header__menu-item {
    margin: 0;
  }

  .moby-header__menu-link {
    display: block;
    padding: 8px 14px;
    color: var(--moby-lime);
    text-decoration: none;
    font-family: var(--font-body--family, system-ui, sans-serif);
    font-size: 12px;
    font-weight: 500;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    transition: opacity 0.2s ease;
    white-space: nowrap;
  }

  .moby-header__menu-link:hover {
    opacity: 0.7;
  }

  /* Actions */
  .moby-header__actions {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .moby-header__icon-btn {
    display: none;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    color: var(--moby-lime);
    text-decoration: none;
    transition: opacity 0.2s ease;
  }

  @media (min-width: 1024px) {
    .moby-header__icon-btn {
      display: flex;
    }
  }

  .moby-header__icon-btn:hover {
    opacity: 0.7;
  }

  /* Currency */
  .moby-header__currency-btn {
    display: none;
    align-items: center;
    gap: 6px;
    padding: 10px 14px;
    background: rgba(249, 253, 181, 0.12);
    border: none;
    border-radius: 100px;
    color: var(--moby-lime);
    font-family: var(--font-body--family, system-ui, sans-serif);
    font-size: 12px;
    font-weight: 500;
    letter-spacing: 0.02em;
    cursor: pointer;
    transition: background 0.2s ease;
  }

  @media (min-width: 1024px) {
    .moby-header__currency-btn {
      display: flex;
    }
  }

  .moby-header__currency-btn:hover {
    background: rgba(249, 253, 181, 0.2);
  }

  .moby-header__caret {
    opacity: 0.8;
  }

  /* Cart */
  .moby-header__cart {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: var(--moby-lime);
    border-radius: 100px;
    color: var(--moby-dark);
    text-decoration: none;
    font-family: var(--font-body--family, system-ui, sans-serif);
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 0.08em;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  @media (min-width: 1024px) {
    .moby-header__cart {
      padding: 10px 20px;
    }
  }

  .moby-header__cart:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 16px rgba(249, 253, 181, 0.25);
  }

  .moby-header__cart-text {
    display: none;
  }

  @media (min-width: 1024px) {
    .moby-header__cart-text {
      display: inline;
    }
  }

  /* Mobile Toggle */
  .moby-header__mobile-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: none;
    border: none;
    color: var(--moby-lime);
    cursor: pointer;
  }

  @media (min-width: 1024px) {
    .moby-header__mobile-toggle {
      display: none;
    }
  }

  /* Mobile Menu */
  .moby-header__mobile-menu {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--moby-olive);
    padding: 100px 24px 24px;
    z-index: -1;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .moby-header__mobile-menu[data-open="true"] {
    opacity: 1;
    visibility: visible;
  }

  .moby-header__mobile-links {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .moby-header__mobile-link {
    display: block;
    padding: 16px 0;
    color: var(--moby-lime);
    text-decoration: none;
    font-size: 20px;
    font-weight: 500;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    border-bottom: 1px solid rgba(249, 253, 181, 0.15);
  }

  /* Spacer for fixed header - only on non-index pages */
  body:not(:has(.moby-header--transparent)) {
    padding-top: 96px;
  }

  @supports not selector(:has(*)) {
    body {
      padding-top: 0;
    }
  }
</style>

<script>
  class MobyHeader extends HTMLElement {
    constructor() {
      super();
      this.lastScrollY = 0;
    }

    connectedCallback() {
      this.handleScroll = this.handleScroll.bind(this);
      this.handleMobileToggle = this.handleMobileToggle.bind(this);

      window.addEventListener('scroll', this.handleScroll, { passive: true });

      const mobileToggle = this.querySelector('.moby-header__mobile-toggle');
      if (mobileToggle) {
        mobileToggle.addEventListener('click', this.handleMobileToggle);
      }

      this.handleScroll();
    }

    disconnectedCallback() {
      window.removeEventListener('scroll', this.handleScroll);
    }

    handleScroll() {
      const scrollY = window.scrollY;

      if (scrollY > 50) {
        this.classList.add('moby-header--scrolled');
      } else {
        this.classList.remove('moby-header--scrolled');
      }

      this.lastScrollY = scrollY;
    }

    handleMobileToggle() {
      const mobileMenu = this.querySelector('.moby-header__mobile-menu');
      const hamburger = this.querySelector('.moby-header__hamburger');
      const close = this.querySelector('.moby-header__close');
      const toggle = this.querySelector('.moby-header__mobile-toggle');

      const isOpen = mobileMenu.dataset.open === 'true';

      mobileMenu.dataset.open = !isOpen;
      mobileMenu.hidden = isOpen;
      toggle.setAttribute('aria-expanded', !isOpen);

      hamburger.style.display = isOpen ? 'block' : 'none';
      close.style.display = isOpen ? 'none' : 'block';

      document.body.style.overflow = isOpen ? '' : 'hidden';
    }
  }

  if (!customElements.get('moby-header')) {
    customElements.define('moby-header', MobyHeader);
  }
</script>

{% schema %}
{
  "name": "MOBY Header",
  "class": "moby-header-section",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    },
    {
      "type": "checkbox",
      "id": "enable_transparent",
      "label": "Transparent header on homepage",
      "default": true
    }
  ]
}
{% endschema %}
